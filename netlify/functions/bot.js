// 1. å¼•å…¥ä¾èµ–ï¼ˆå’Œä½ åŸæ¥çš„index.jsä¸€è‡´ï¼Œå°‘äº†å°±åŠ ä¸Šï¼‰
const express = require('express');
const serverless = require('serverless-http'); // Netlifyäº‘å‡½æ•°å¿…éœ€ä¾èµ–
const cors = require('cors');

// 2. åˆå§‹åŒ–Expresså®ä¾‹
const app = express();

// 3. å¤åˆ¶ä½ åŸæ¥index.jsé‡Œçš„æ‰€æœ‰ä¸­é—´ä»¶é…ç½®ï¼ˆæ¯”å¦‚ä¸‹é¢è¿™äº›ï¼Œæœ‰å¤šå°‘å¤åˆ¶å¤šå°‘ï¼‰
app.use(cors()); // è·¨åŸŸä¸­é—´ä»¶ï¼ˆä½ åŸæ¥çš„ä»£ç é‡Œæœ‰è¿™ä¸ªï¼Œå¿…é¡»ä¿ç•™ï¼‰
app.use(express.json()); // è§£æJSONæ ¼å¼è¯·æ±‚ï¼ˆå¦‚æœåŸæ¥æœ‰å°±ä¿ç•™ï¼Œæ²¡æœ‰ä¹ŸåŠ ä¸Šï¼‰
app.use(express.urlencoded({ extended: true })); // è§£æè¡¨å•æ ¼å¼è¯·æ±‚ï¼ˆåŒä¸Šï¼‰

// 4. ğŸ‘‡ å…³é”®æ­¥éª¤ï¼šå¤åˆ¶ä½ åŸæ¥index.jsé‡Œçš„æ‰€æœ‰è·¯ç”±/ä¸šåŠ¡é€»è¾‘
// ç¤ºä¾‹ï¼šæŠŠä½ åŸæ¥çš„app.getã€app.postç­‰å…¨éƒ¨å¤åˆ¶åˆ°è¿™é‡Œ
// æ¯”å¦‚ä½ åŸæ¥çš„é¦–é¡µæ¥å£ã€BOTç›¸å…³æ¥å£ï¼Œå…¨éƒ¨ç²˜è´´åˆ°è¿™é‡Œ
// ä¸¾ä¸ªä¾‹å­ï¼ˆä½ æ›¿æ¢æˆè‡ªå·±çš„ä»£ç å³å¯ï¼‰ï¼š
app.get('/', (req, res) => {
  res.send('ä½ çš„å°å¤©æ‰BOTæœåŠ¡æ­£å¸¸è¿è¡Œå•¦ï¼'); // è¿™æ˜¯ç¤ºä¾‹ï¼Œæ›¿æ¢æˆä½ åŸæ¥çš„è¿”å›å†…å®¹
});
// ä½ çš„å…¶ä»–æ¥å£ï¼šæ¯”å¦‚ app.get('/api/bot', (req,res)=>{...}) å…¨éƒ¨å¤åˆ¶åˆ°è¿™é‡Œ
// ï¼ˆå¦‚æœä½ çš„index.jsé‡Œæœ‰æ›´å¤šé€»è¾‘ï¼Œæ¯”å¦‚å˜é‡å®šä¹‰ã€å·¥å…·å‡½æ•°ï¼Œä¹Ÿå…¨éƒ¨å¤åˆ¶åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæ”¾åœ¨è¿™ä¸Šé¢æˆ–ä¸‹é¢éƒ½å¯ä»¥ï¼‰

// 5. ğŸ‘‡ Netlifyäº‘å‡½æ•°å¿…éœ€ï¼šå¯¼å‡ºhandlerï¼Œå›ºå®šæ ¼å¼ï¼Œä¸ç”¨æ”¹
const handler = serverless(app);
module.exports.handler = async (event, context) => {
  const result = await handler(event, context);
  return result;
};
